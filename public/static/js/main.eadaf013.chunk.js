(this.webpackJsonpbottender_view=this.webpackJsonpbottender_view||[]).push([[0],{362:function(e,t,n){e.exports=n(450)},367:function(e,t,n){},368:function(e,t,n){},450:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),c=n.n(o),i=(n(367),n(57)),u=(n(368),n(309)),l=n(468),s=n(310),d=n(90),m=n(311),f=n(242),p=n(350),h=n.n(p),g=Object(u.a)((function(e){return{root:{flexGrow:1,backgroundColor:"#00bcd4"},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}));function E(){window.liff.login({redirectUri:"".concat(window.location.origin,"/?reactRedirectUri=").concat(window.location.pathname)})}var b=function(){var e=g(),t=r.a.useState(window.liff.isLoggedIn()),n=Object(i.a)(t,2),a=n[0],o=n[1];return r.a.createElement(l.a,{position:"static",className:e.root},r.a.createElement(s.a,null,r.a.createElement(f.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu"},r.a.createElement(h.a,null)),r.a.createElement(d.a,{variant:"h6",className:e.title},"Re:dive LineBot"),a?r.a.createElement(m.a,{color:"inherit",onClick:function(){window.liff.logout(),o(!1)}},"\u767b\u51fa"):r.a.createElement(m.a,{color:"inherit",onClick:E},"\u767b\u5165")))},w=n(152),v=n(29),y=n(484),k=n(485),j=n(481),O=n(239),C=n(477),G=n(89),I=n.n(G),S=n(123),x=n(107),T=n(154),D=n.n(T),R=n(82),L=n.n(R),N={token:"",fetchGroupSpeakRank:function(e){return L.a.get("/api/Group/".concat(e,"/Speak/Rank"))},fetchGroupConfig:function(e){return L.a.get("/api/Group/".concat(e,"/Config"))},fetchGroupConfigData:function(){return L.a.get("/api/GroupConfig")},switchGroupConfig:function(e,t,n){return L.a.put("/api/Group/".concat(e,"/Name/").concat(t,"/").concat(n),{headers:{Authorization:"Bearer ".concat(this.token)}})}};function B(){return(B=Object(S.a)(I.a.mark((function e(t){var n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.fetchGroupSpeakRank(t);case 2:return n=e.sent,e.abrupt("return",M(n.data));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){var t=e.map((function(e){return e.speakTimes})).reduce((function(e,t){return e+t}));return e.map((function(e,n){var a=new Date(e.joinedTS),r=new Date(e.lastSpeakTS);return{no:n+1,name:e.displayName,speakTimes:e.speakTimes,lastSpeakDTM:null===e.lastSpeakTS?"-":[r.getFullYear(),r.getMonth()+1,r.getDate()].join("/"),speakPercentage:Math.round(e.speakTimes/t*100)+"%",joinedDTM:[a.getFullYear(),a.getMonth()+1,a.getDate()].join("/")}}))}var P=function(e){var t=e.groupId,n=Object(a.useState)({columns:[{title:"\u6392\u540d",field:"no"},{title:"\u59d3\u540d",field:"name"},{title:"\u8aaa\u8a71\u6b21\u6578",field:"speakTimes",hidden:document.body.clientWidth<=1e3},{title:"\u8aaa\u8a71\u5360\u6bd4",field:"speakPercentage"},{title:"\u4e0a\u6b21\u8aaa\u8a71",field:"lastSpeakDTM"},{title:"\u958b\u59cb\u8a18\u9304\u6642\u9593",field:"joinedDTM",type:"datetime",hidden:document.body.clientWidth<=1e3}],data:[]}),o=Object(i.a)(n,2),c=o[0],u=o[1];return r.a.useEffect((function(){void 0!==t&&function(e){return B.apply(this,arguments)}(t).then((function(e){return u(Object(x.a)({},c,{data:e}))}))}),[]),r.a.createElement(D.a,{title:"\u7fa4\u7d44\u8aaa\u8a71\u6b21\u6578\u6392\u884c",columns:c.columns,data:c.data,options:{search:!1}})},U=function(){var e=Object(v.g)();return r.a.useEffect((function(){window.document.title="\u7fa4\u7d44\u8aaa\u8a71\u6392\u884c"}),[]),r.a.createElement(j.a,null,r.a.createElement(O.a,{m:2},r.a.createElement(C.a,{container:!0,direction:"column",justify:"space-around"},r.a.createElement(C.a,{item:!0},r.a.createElement(k.a,{severity:"info"},r.a.createElement(y.a,null,"\u6ce8\u610f\u4e8b\u9805"),r.a.createElement("li",null,"\u6bcf\u500b\u67081\u865f\u6e96\u6642\u6e05\u9664\u8cc7\u6599\u4e26\u91cd\u65b0\u7d71\u8a08")))),r.a.createElement(C.a,{container:!0},r.a.createElement(C.a,{item:!0,xs:12},r.a.createElement(P,{groupId:e.groupId})))))},K=n(254),Y=function(e){return L.a.get("/api/Source/".concat(e,"/Customer/Orders"))},W=function(e,t){return L()({method:"PUT",data:t,url:"/api/Source/".concat(e,"/Customer/Orders")})},z=n(458),F=n(329),J=n(482),_=n(4),A=Object(_.a)({root:{padding:"10px 30px"}})(j.a);function $(e){return r.a.createElement(A,null,r.a.createElement(d.a,{variant:"h5"},"\u56de\u8986\u5167\u5bb9"),r.a.createElement(z.a,null,e.replies.map((function(e,t,n){return r.a.createElement(r.a.Fragment,{key:t},r.a.createElement(F.a,{primary:e.reply,secondary:"text"===e.type?"\u6587\u5b57":"\u5716\u7247"}),t<n.length-1?r.a.createElement(J.a,{component:"li"}):null)}))))}function q(){return(q=Object(S.a)(I.a.mark((function e(t){var n,a,r,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(t);case 2:return n=e.sent,a=n.data,r={},a.forEach((function(e){r[e.orderKey]=r[e.orderKey]||[],r[e.orderKey].push({type:e.messageType,reply:e.reply})})),o=Object.keys(r).map((function(e){var t=a.find((function(t){return t.orderKey===e}));return{order:t.cusOrder,touchType:t.touchType,replies:r[e],status:1,orderKey:e}})),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=function(e){var t=e.sourceId,n=Object(a.useState)({columns:[{title:"\u6307\u4ee4",field:"order"},{title:"\u89f8\u767c\u65b9\u5f0f",field:"touchType",lookup:{1:"\u5b8c\u5168\u7b26\u5408",2:"\u95dc\u9375\u5b57\u89f8\u767c"}},{title:"\u72c0\u614b",field:"status",lookup:{0:"\u95dc\u9589",1:"\u555f\u7528"}},{title:"\u56de\u8986",field:"replies",hidden:!0},{title:"\u91d1\u9470",field:"orderKey",hidden:!0}],data:[]}),o=Object(i.a)(n,2),c=o[0],u=o[1];return Object(a.useEffect)((function(){(function(e){return q.apply(this,arguments)})(t).then((function(e){return u((function(t){return Object(x.a)({},t,{data:e})}))}))}),[]),r.a.createElement(D.a,{title:"\u81ea\u8a02\u6307\u4ee4\u5217\u8868",columns:c.columns,data:c.data,options:{search:!1},detailPanel:[{tooltip:"\u9ede\u6211\u770b\u8a73\u7d30",render:$}],localization:{header:{actions:"\u7de8\u8f2f"}},editable:{onRowUpdate:function(e,n){var a=Object(K.a)(c.data),r=n.tableData.id;return a[r]=e,u((function(e){return Object(x.a)({},e,{data:Object(K.a)(a)})})),W(t,e)}}})},Q=function(){var e=Object(v.g)();return r.a.useEffect((function(){window.document.title="\u81ea\u8a02\u6307\u4ee4\u7ba1\u7406"}),[]),r.a.createElement(j.a,null,r.a.createElement(O.a,{m:2},r.a.createElement(C.a,{container:!0,direction:"column",justify:"space-around"},r.a.createElement(C.a,{item:!0},r.a.createElement(k.a,{severity:"info"},r.a.createElement(y.a,null,"\u6ce8\u610f\u4e8b\u9805"),r.a.createElement("li",null,"\u5169\u500b\u6708\u672a\u89f8\u767c\u6307\u4ee4\u9032\u884c\u522a\u9664"),r.a.createElement("li",null,"\u76f8\u540c\u6307\u4ee4\u3001\u56de\u8986\uff0c\u7121\u6cd5\u91cd\u8907\u65b0\u589e"),r.a.createElement("li",null,"\u5b8c\u5168\u7b26\u5408\u7684\u6307\u4ee4\u512a\u5148\u89f8\u767c")))),r.a.createElement(C.a,{container:!0},r.a.createElement(C.a,{item:!0,xs:12},r.a.createElement(H,{sourceId:e.sourceId})))))},V=n(478),X=n(479),Z=n(480),ee=n(483),te=Object(u.a)((function(){return{card:{minWeight:275,display:"grid",height:"100%"},footer:{marginTop:"auto",marginLeft:"auto"}}}));function ne(e){var t=te(),n=r.a.useState("Y"===e.status),a=Object(i.a)(n,2),o=a[0],c=a[1],u=e.name,l=e.handle,s=e.isLoggedIn;return r.a.createElement(V.a,{className:t.card},r.a.createElement(Z.a,null,r.a.createElement(d.a,{variant:"h5",component:"h2"},e.title),r.a.createElement(d.a,{variant:"body2",component:"p"},e.description)),r.a.createElement(X.a,{className:t.footer},r.a.createElement(ee.a,{checked:o,onChange:s?function(){l(u,!o),c(!o)}:function(){},color:"primary",name:"checkedB",inputProps:{"aria-label":"primary checkbox"},disabled:!s})))}var ae=Object(u.a)((function(){return{root:{flexGrow:1}}})),re=function(e){var t=e.datas,n=e.config,a=e.handle,o=e.isLoggedIn,c=[];return t.forEach((function(e,t){c[parseInt(t/3)]=c[parseInt(t/3)]||[],c[parseInt(t/3)].push(e)})),c.map((function(e,t){var c=e.map((function(e,t){return r.a.createElement(C.a,{item:!0,xs:12,sm:4,key:t},r.a.createElement(ne,Object.assign({},e,{status:n[e.name],handle:a,isLoggedIn:o})))}));return r.a.createElement(C.a,{container:!0,item:!0,xs:12,spacing:3,key:t},c)}))},oe=function(){var e=ae(),t=window.liff.isLoggedIn(),n=r.a.useState({GroupConfigData:[],GroupConfig:{Battle:"Y",PrincessCharacter:"Y",CustomerOrder:"Y"}}),a=Object(i.a)(n,2),o=a[0],c=a[1],u=Object(v.g)().groupId;function l(){return(l=Object(S.a)(I.a.mark((function e(){var t,n,a,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([N.fetchGroupConfigData().then((function(e){return e.data})),N.fetchGroupConfig(u).then((function(e){return e.data}))]);case 2:t=e.sent,n=Object(i.a)(t,2),a=n[0],r=n[1],c(Object(x.a)({},o,{GroupConfigData:a,GroupConfig:r}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.useEffect((function(){window.document.title="\u529f\u80fd\u958b\u95dc\u8a2d\u5b9a",function(){l.apply(this,arguments)}()}),[]),r.a.createElement(j.a,null,r.a.createElement("div",{className:e.root,style:{marginTop:10}},r.a.createElement(C.a,{container:!0,spacing:1},t?null:r.a.createElement(C.a,{item:!0},r.a.createElement(k.a,{severity:"warning"},"\u767b\u5165\u5f8c\u5373\u53ef\u9032\u884c\u64cd\u4f5c\uff01")),r.a.createElement(re,{datas:o.GroupConfigData,config:o.GroupConfig,handle:function(e,t){return N.switchGroupConfig(u,e,t?1:0)},isLoggedIn:t}))))},ce=n(463),ie=n(312),ue=Object(u.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}}));var le=function(){var e=ue(),t=r.a.useState(!0),n=Object(i.a)(t,2),a=n[0],o=n[1];return r.a.useEffect((function(){var e=window.liff;L.a.get("/send-id").then((function(e){return e.data})).then((function(t){return e.init({liffId:t.id})})).then((function(){return o(!1)}))}),[]),a?r.a.createElement(ce.a,{className:e.backdrop,open:!0},r.a.createElement(ie.a,{color:"inherit"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(b,null),r.a.createElement(w.a,null,function(){var e=new URLSearchParams(window.location.search);return!1===e.has("reactRedirectUri")?null:r.a.createElement(v.a,{to:e.get("reactRedirectUri")})}(),r.a.createElement(v.d,null,r.a.createElement(v.b,{path:"/Group/:groupId/Record",component:U}),r.a.createElement(v.b,{path:"/Source/:sourceId/Customer/Orders",component:Q}),r.a.createElement(v.b,{path:"/Group/:groupId/Config",component:oe}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(le,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[362,1,2]]]);
//# sourceMappingURL=main.eadaf013.chunk.js.map